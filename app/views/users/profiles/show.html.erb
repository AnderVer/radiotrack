<% content_for :title, "–ü—Ä–æ—Ñ–∏–ª—å ‚Äî RadioTrack" %>

<div class="profile-container">
  <h2 class="mb-3">–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>

  <div class="profile-section">
    <h3 class="mb-2">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
    <div class="info-row">
      <span class="info-label">Email:</span>
      <span class="info-value"><%= @user.email.presence || "–ù–µ —É–∫–∞–∑–∞–Ω" %></span>
    </div>
    <div class="info-row">
      <span class="info-label">–°–ø–æ—Å–æ–±—ã –≤—Ö–æ–¥–∞:</span>
      <span class="info-value">
        <% if @user.identities.any? %>
          <% @user.identities.each do |identity| %>
            <span class="badge badge-<%= identity.provider %>">
              <%= identity.provider == "vk" ? "–í–ö–æ–Ω—Ç–∞–∫—Ç–µ" : identity.provider.humanize %>
            </span>
          <% end %>
        <% else %>
          Email / –ü–∞—Ä–æ–ª—å
        <% end %>
      </span>
    </div>
  </div>

  <div class="profile-section">
    <h3 class="mb-2">–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏</h3>
    <div class="subscription-status status-<%= @user.plan_code %>">
      <% if @user.paid? %>
        <div class="status-icon">‚úÖ</div>
        <div class="status-info">
          <strong>Paid</strong> ‚Äî –ê–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
        </div>
        <div class="status-details">
          –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: <%= l @user.paid_until, format: :long %>
        </div>
      <% elsif @user.authenticated? %>
        <div class="status-icon">üë§</div>
        <div class="status-info">
          <strong>Auth</strong> ‚Äî –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        </div>
        <div class="status-details">
          <%= link_to "–ü–æ–ª—É—á–∏—Ç—å Premium", new_user_registration_path, class: "btn btn-primary btn-sm" %>
        </div>
      <% else %>
        <div class="status-icon">üë§</div>
        <div class="status-info">
          <strong>Guest</strong> ‚Äî –ì–æ—Å—Ç—å
        </div>
        <div class="status-details">
          <%= link_to "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è", new_user_registration_path, class: "btn btn-primary btn-sm" %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="profile-section">
    <h3 class="mb-2">–í–∞—à–∏ –ª–∏–º–∏—Ç—ã</h3>
    <table class="limits-table">
      <thead>
        <tr>
          <th>–§—É–Ω–∫—Ü–∏—è</th>
          <th>–í–∞—à –ª–∏–º–∏—Ç</th>
          <th>Premium</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>–ó–∞–∫–ª–∞–¥–∫–∏ —Å—Ç–∞–Ω—Ü–∏–π</td>
          <td><%= @user.bookmarks_limit || "‚àû" %></td>
          <td>‚àû</td>
        </tr>
        <tr>
          <td>–ü–ª–µ–π–ª–∏—Å—Ç—ã</td>
          <td><%= @user.playlists_limit || "‚àû" %></td>
          <td><%= User::PAID_PLAYLISTS_LIMIT %></td>
        </tr>
        <tr>
          <td>–¢—Ä–µ–∫–æ–≤ –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ</td>
          <td><%= @user.playlist_items_per_playlist_limit || "‚àû" %></td>
          <td><%= User::PAID_PLAYLIST_ITEMS_LIMIT %></td>
        </tr>
        <tr>
          <td>–ü–æ–ø—ã—Ç–∫–∏ "–ì–¥–µ –∏–≥—Ä–∞–µ—Ç" (–≤ –¥–µ–Ω—å)</td>
          <td><%= @user.trial_tune_in_remaining || "‚àû" %> –æ—Å—Ç–∞–ª–æ—Å—å —Å–µ–≥–æ–¥–Ω—è</td>
          <td>‚àû</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="profile-section">
    <h3 class="mb-2">–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
    <ul class="features-list">
      <li class="<%= 'available' if @user.can_access_last_track? %>">
        –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç—Ä–µ–∫ –≤ —ç—Ñ–∏—Ä–µ
        <% unless @user.can_access_last_track? %>
          <span class="badge badge-warning">Premium</span>
        <% end %>
      </li>
      <li class="<%= 'available' if @user.can_access_playlist? %>">
        –ü–ª–µ–π–ª–∏—Å—Ç —ç—Ñ–∏—Ä–∞ –∑–∞ 30 –º–∏–Ω—É—Ç
        <% unless @user.can_access_playlist? %>
          <span class="badge badge-warning">Premium</span>
        <% end %>
      </li>
      <li class="<%= 'available' if @user.can_access_forecast? %>">
        –ü—Ä–æ–≥–Ω–æ–∑ "–ë—É–¥–µ—Ç —Å–∫–æ—Ä–æ"
        <% unless @user.can_access_forecast? %>
          <span class="badge badge-warning">Premium</span>
        <% end %>
      </li>
      <li class="<%= 'available' if @user.can_capture_now_playing? %>">
        –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ç—Ä–µ–∫–∞
        <% unless @user.can_capture_now_playing? %>
          <span class="badge badge-warning">Premium</span>
        <% end %>
      </li>
      <li class="<%= 'available' if @user.can_tune_in? %>">
        "–ì–¥–µ –∏–≥—Ä–∞–µ—Ç" (trial: <%= @user.trial_tune_in_remaining || "‚àû" %> –ø–æ–ø—ã—Ç–æ–∫)
      </li>
    </ul>
  </div>

  <% unless @user.paid? %>
    <div class="profile-section">
      <h3 class="mb-2">–î–µ–π—Å—Ç–≤–∏—è</h3>
      <%= button_to "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–µ–º–æ-–ø–æ–¥–ø–∏—Å–∫—É (30 –¥–Ω–µ–π)", activate_demo_subscription_path, method: :post, class: "btn btn-primary" %>
    </div>
  <% end %>

  <% if @user.paid? %>
    <div class="profile-section">
      <h3 class="mb-2">–î–µ–π—Å—Ç–≤–∏—è</h3>
      <%= button_to "–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É", cancel_subscription_path, method: :post, class: "btn btn-secondary", data: { confirm: "–í—ã —É–≤–µ—Ä–µ–Ω—ã?" } %>
    </div>
  <% end %>

  <div class="profile-section">
    <h3 class="mb-2">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–º</h3>
    <%= link_to "–ò–∑–º–µ–Ω–∏—Ç—å email –∏–ª–∏ –ø–∞—Ä–æ–ª—å", edit_user_registration_path, class: "btn btn-secondary btn-sm" %>
    <%= link_to "–í—ã–π—Ç–∏", destroy_user_session_path, method: :delete, class: "btn btn-secondary btn-sm" %>
  </div>
</div>

<style>
  .profile-container {
    max-width: 800px;
    margin: 0 auto;
    background: #fff;
    padding: 24px;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }

  .profile-section {
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid #eee;
  }

  .profile-section:last-child {
    border-bottom: none;
  }

  .info-row {
    display: flex;
    padding: 8px 0;
    border-bottom: 1px solid #f5f5f5;
  }

  .info-row:last-child {
    border-bottom: none;
  }

  .info-label {
    font-weight: 500;
    width: 150px;
    color: #666;
  }

  .info-value {
    flex: 1;
  }

  .subscription-status {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 16px;
  }

  .status-guest {
    background: #f5f5f5;
  }

  .status-auth {
    background: #e3f2fd;
  }

  .status-paid {
    background: #e8f5e9;
  }

  .status-icon {
    font-size: 32px;
  }

  .status-info strong {
    font-size: 18px;
    display: block;
  }

  .status-details {
    color: #666;
    font-size: 14px;
  }

  .limits-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }

  .limits-table th,
  .limits-table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #eee;
  }

  .limits-table th {
    background: #f9f9f9;
    font-weight: 600;
  }

  .features-list {
    list-style: none;
  }

  .features-list li {
    padding: 8px 0;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .features-list li.available {
    color: #28a745;
  }

  .badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
  }

  .badge-vk {
    background: #0077FF;
    color: #fff;
  }

  .badge-yandex {
    background: #FC3F1D;
    color: #fff;
  }

  .badge-telegram {
    background: #0088cc;
    color: #fff;
  }

  .badge-warning {
    background: #ffc107;
    color: #333;
  }
</style>
