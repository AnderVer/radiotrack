<% content_for :title, "–ü—Ä–æ—Ñ–∏–ª—å ‚Äî RadioTrack" %>

<div class="main">
  <h1 class="mb-3">–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>

  <div style="display: grid; gap: 24px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
    <!-- Account Info -->
    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 20px;">
      <h2 class="mb-3">üë§ –ê–∫–∫–∞—É–Ω—Ç</h2>
      <div class="mb-2">
        <strong>Email:</strong> <%= current_user.email %>
      </div>
      <div class="mb-2">
        <strong>–ü–ª–∞–Ω:</strong>
        <% case current_user.plan_code %>
        <% when "paid" %>
          <span class="badge badge-success">Premium</span>
        <% when "auth" %>
          <span class="badge badge-primary">Auth</span>
        <% else %>
          <span class="badge badge-warning">Guest</span>
        <% end %>
      </div>
      <% if current_user.paid? %>
        <div class="mb-2">
          <strong>–ü–æ–¥–ø–∏—Å–∫–∞ –¥–æ:</strong> <%= l current_user.paid_until, format: :long %>
        </div>
      <% end %>
      <% if current_user.guest? %>
        <div class="mb-2">
          <strong>–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫ "–ì–¥–µ –∏–≥—Ä–∞–µ—Ç":</strong> <%= current_user.trial_tune_in_remaining || 0 %>
        </div>
      <% end %>
    </div>

    <!-- Subscription Status -->
    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 20px;">
      <h2 class="mb-3">üéµ –ü–æ–¥–ø–∏—Å–∫–∞</h2>

      <% if current_user.paid? %>
        <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px; padding: 16px; margin-bottom: 16px;">
          <strong style="color: #155724;">‚úÖ Premium –∞–∫—Ç–∏–≤–Ω–∞</strong>
          <p style="margin: 8px 0 0 0; color: #155724;">
            –í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ <%= l current_user.paid_until, format: :date %>
          </p>
        </div>

        <ul style="margin-bottom: 16px; padding-left: 20px;">
          <li>‚úÖ –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç—Ä–µ–∫ –≤ —ç—Ñ–∏—Ä–µ</li>
          <li>‚úÖ –ü–ª–µ–π–ª–∏—Å—Ç —ç—Ñ–∏—Ä–∞ –∑–∞ 30 –º–∏–Ω—É—Ç</li>
          <li>‚úÖ –ü—Ä–æ–≥–Ω–æ–∑ "–ë—É–¥–µ—Ç —Å–∫–æ—Ä–æ"</li>
          <li>‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞ –≤ –ø–ª–µ–π–ª–∏—Å—Ç</li>
          <li>‚úÖ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –∑–∞–∫–ª–∞–¥–∫–∏</li>
        </ul>

        <%= button_to "–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É (–¥–µ–º–æ)", user_cancel_subscription_path, method: :post, class: "btn btn-secondary", data: { confirm: "–í—ã —É–≤–µ—Ä–µ–Ω—ã?" } %>
      <% else %>
        <div class="paywall" style="margin-bottom: 16px;">
          <h3>üéµ Premium –¥–æ—Å—Ç—É–ø</h3>
          <p>–ü–æ–ª—É—á–∏—Ç–µ –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º</p>
        </div>

        <ul style="margin-bottom: 16px; padding-left: 20px;">
          <li>‚ùå –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç—Ä–µ–∫ –≤ —ç—Ñ–∏—Ä–µ</li>
          <li>‚ùå –ü–ª–µ–π–ª–∏—Å—Ç —ç—Ñ–∏—Ä–∞ –∑–∞ 30 –º–∏–Ω—É—Ç</li>
          <li>‚ùå –ü—Ä–æ–≥–Ω–æ–∑ "–ë—É–¥–µ—Ç —Å–∫–æ—Ä–æ"</li>
          <li>‚úÖ –ó–∞–∫–ª–∞–¥–∫–∏ —Å—Ç–∞–Ω—Ü–∏–π (–ª–∏–º–∏—Ç: <%= current_user.bookmarks_limit || "‚àû" %>)</li>
          <li>‚úÖ –ü–ª–µ–π–ª–∏—Å—Ç—ã (–ª–∏–º–∏—Ç: <%= current_user.playlists_limit %>)</li>
        </ul>

        <%= button_to "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–µ–º–æ-–ø–æ–¥–ø–∏—Å–∫—É (30 –¥–Ω–µ–π)", user_activate_demo_subscription_path, method: :post, class: "btn btn-primary" %>
        <p class="text-sm text-muted mt-2">
          –î–µ–º–æ-–ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 30 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ
        </p>
      <% end %>
    </div>

    <!-- OAuth Identities -->
    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 20px;">
      <h2 class="mb-3">üîó –ü—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã</h2>

      <% if current_user.identities.any? %>
        <ul style="margin-bottom: 16px;">
          <% current_user.identities.each do |identity| %>
            <li class="mb-2">
              <span class="badge badge-primary"><%= identity.provider.capitalize %></span>
              <span class="text-muted text-sm ml-2">UID: <%= identity.uid %></span>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p class="text-muted mb-3">–ù–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤</p>
      <% end %>

      <div style="display: flex; gap: 8px; flex-wrap: wrap;">
        <%= button_to "–ü—Ä–∏–≤—è–∑–∞—Ç—å VK", user_vk_omniauth_authorize_path, method: :post, data: { turbo: false }, class: "btn btn-secondary btn-sm" %>
        <%= button_to "–ü—Ä–∏–≤—è–∑–∞—Ç—å Yandex", user_yandex_omniauth_authorize_path, method: :post, data: { turbo: false }, class: "btn btn-secondary btn-sm" %>
      </div>
    </div>

    <!-- Account Actions -->
    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 20px;">
      <h2 class="mb-3">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

      <div style="display: flex; flex-direction: column; gap: 12px;">
        <%= link_to "–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å", edit_user_registration_path, class: "btn btn-secondary" %>
        <%= link_to "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å", edit_user_registration_path, class: "btn btn-secondary" %>
        <%= button_to "–í—ã–π—Ç–∏", destroy_user_session_path, method: :delete, class: "btn btn-secondary", data: { confirm: "–í—ã —É–≤–µ—Ä–µ–Ω—ã?" } %>
      </div>
    </div>
  </div>
</div>
